angular.module("fullscreen.tv",["ngCookies","templates","firebase"]).config(function(){var e;return e={getFilename:function(e,r){var n;return null==r&&(r=!0),n=_.last(e.split("/")),r?_.first(n.split(".")):n}},_.mixin(e)}).run(["$cookies","analytics",function(e,r){var n,t;return t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},n=function(){return""+t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},e.guid||(e.guid=n()),r.identify(e.guid)}]),angular.module("fullscreen.tv").directive("upload",["$fileUploader","$location",function(e,r){return{restrict:"E",replace:!0,templateUrl:"upload.html",link:function(n){var t;return t=e.create({url:"/videos",alias:"video[file]",autoUpload:!0}),t.bind("completeall",function(){return t.clearQueue(),r.path("/uploads/manager")}),n.uploader=t}}}]),angular.module("fullscreen.tv").directive("uploadsManager",["$http","$timeout","$location","firebase","zencoder",function(e,r,n,t,o){return{restrict:"E",templateUrl:"../views/uploads_manager.html",link:function(e){var n,i,u;return e.uploads=t.getUploads(),e.uploads.$on("loaded",function(){return i()}),n=function(e,r){var n;return n=_.filter(e,function(e){return(null!=e?e.state:void 0)===r})},u=function(e){return _.each(e,function(e){return o.getJobProgress(e.id,e.job_id)})},i=function(t){var o,a,l,c;return null==t&&(t=5e3),o=u(n(e.uploads,"encoding")),a=u(n(e.uploads,"processing")),c=u(n(e.uploads,"waiting")),l=_.union(o,a,c),_.isEmpty(l)||r(function(){return l=i()},t),l},e.updateAllInWork=i},controller:["$scope",function(r){return r.kickOffJob=function(n){return e.post("videos/"+n+"/publish").then(function(){return r.updateAllInWork()})},r.removeUpload=function(r){return e["delete"]("videos/"+r)},r.watch=function(e,r){return"finished"===r?n.path("/watch/"+e):void 0}}]}}]),angular.module("fullscreen.tv").controller("uploadsController",["$scope","firebase",function(e,r){return e.userUploads=r.userUploads}]),angular.module("fullscreen.tv").directive("contenteditable",function(){return{restrict:"A",require:"ngModel",scope:{onBlur:"&"},link:function(e,r,n,t){return r.bind("keypress",function(){return function(e){return 13===e.keyCode?(e.preventDefault(),$(r).trigger("blur")):void 0}}(this)),r.bind("blur",function(){return e.$apply(function(){return t.$setViewValue(r.html()),r.addClass("edited"),e.onBlur()})}),t.$render=function(){return function(){return r.html(t.$viewValue)}}(this),t.$render()}}}),angular.module("fullscreen.tv").directive("filepicker",["$window","firebase","analytics","zencoder",function(e,r,n,t){return{restrict:"A",link:function(r){return r.filepicker=e.filepicker,r.filepicker.setKey("AiCDu1zCuQQysPoX9Mb9bz")},controller:["$scope",function(e){var o,i,u,a,l;return i={picker:{services:["COMPUTER","DROPBOX","BOX","GOOGLE_DRIVE"],container:"window",multiple:!0,mimetype:"video/*"},store:{path:"uploads/"+r.guid+"/"}},l=function(e){return u(e),a(e),n.track("Upload: Success",e)},o=function(e){return n.track("Upload: Error",e.toString())},u=function(e){return _(e).each(function(e){var n;return n=_.getFilename(e.key),e.displayName=n,r.userUploads[n]=e,r.userUploads.$save(n)})},a=function(e){var n;return n=_(e).pluck("key"),_(n).each(function(e){var n;return n=_.getFilename(e),console.log("filename",n),t.createJob(e).then(function(e){return r.userUploads.$child(n).$update({job:e.data.id}),r.userEncodes.$child(n).$update({jobId:e.data.id,files:e.data.outputs})})})},e.pick=function(){return e.filepicker.pickAndStore(i.picker,i.store,l,o)}}]}}]),angular.module("fullscreen.tv").directive("player",function(){return{restrict:"E",replace:!0,templateUrl:"player.html",scope:{video:"=",playlist:"="},link:function(e){return videojs("player").ready(function(){return e.player?void 0:(e.player=this,this.on("ended",function(){var r;return r=_.at(e.playlist,e.video.id),console.log("nextvideo",r)}))})},controller:["$scope",function(e){return e.$watch("playlist",function(r){var n;return console.log("playlist",r),e.video=getPlaybackVideo(r[null!=(n=e.video)?n.id:void 0])}),e.$watch("video",function(r){return r?void 0:e.video=getPlaybackVideo(null!=e?e.playlist[null!=r?r.id:void 0]:void 0)})}]}}),angular.module("fullscreen.tv").directive("speech",["$window",function(e){return{restrict:"A",link:function(r,n,t){var o,i,u,a,l,c;if(null!=e?e.speechSynthesis:void 0)return n.addClass("ba-speech"),u=e.speechSynthesis,a=e.SpeechSynthesisUtterance,c=new a,l=function(e){return r.speaking=e,r.$digest()},c.onstart=function(){return l(!0)},c.onend=function(){return l(!1)},c.onpause=function(){return l(!1)},c.onresume=function(){return l(!0)},u.onvoiceschanged=function(){return function(){return c.voice=o(null!=t?t.language:void 0),t.debug&&console.log(c.voice),c.voiceURI=c.voice.voiceURI,c.lang=c.voice.lang,c.volume=1,c.rate=1.2,c.pitch=1}}(this),o=function(e){var r,n,t;return t=u.getVoices(),n=_(t).findWhere({"default":!0}),r=_(t).findWhere({lang:e}),r?r:n},i=function(e){return e?(c.text=e,u.speak(c)):void 0},angular.element(n).bind("click",function(){return u.cancel(),i(t.speech)})}}}]);var __slice=[].slice;angular.module("fullscreen.tv").factory("analytics",function(){var e;return e={},["page","pageview","track","identify"].forEach(function(r){return e[r]=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],window.analytics[r].apply(window.analytics,e)}}),e}).run(["analytics","$rootScope",function(e,r){return r.$on("$routeChangeSuccess",function(){return e.page()})}]),angular.module("fullscreen.tv").constant("config",{env:"development",zencoder:{integration:"",read:"",full:""},firebase:{"default":"https://supernova.firebaseio.com/",uploads:"https://supernova.firebaseio.com/uploads",encodes:"https://supernova.firebaseio.com/encodes",clock:"https://supernova.firebaseio.com/.info/serverTimeOffset"}}),angular.module("fullscreen.tv").service("firebase",["$firebase","$cookies","config","$rootScope","$q",function(e,r,n,t,o){var i,u,a,l,c,s,d,f;return i=new Firebase(n.firebase.clock),l=r.guid,s=e(new Firebase(n.firebase.uploads)),f=s.$child(l),u=e(new Firebase(n.firebase.encodes)),d=u.$child(l),a=function(){var e;return e=o.defer(),i.on("value",function(r){var n;return n=Date.now()+r.val(),e.resolve(n)}),e.promise},c={uploads:e(new Firebase(n.firebase.uploads)),userUploads:f,userEncodes:d,getServerTime:a,guid:l}}]),angular.module("fullscreen.tv").service("liveSync",["firebase","$window",function(e,r){var n,t,o;return navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,n=r.AudioContext||r.webkitAudioContext,o=function(e,r,t){var o,i,u;return i=(r-e)%t,console.log("jumpTo (in seconds)",i/1e3),console.log("jumpTo (in minutes)",i/1e3/60),o={video:!1,audio:!0},u=function(e){var r,t,o;return r=new n,o=r.createMediaStreamSource(e),t=r.createBiquadFilter(),o.connect(t),t.connect(r.destination)},navigator.getMedia(o,u)},e.getServerTime().then(function(e){var r,n;return n=13956876e5,r=132e4,o(n,e,r)}),t={sync:o}}]),angular.module("fullscreen.tv").service("zencoder",["$http","firebase",function(e,r){var n,t,o,i,u,a,l;return u=r.guid,n="https://app.zencoder.com/api/v2",a={read:"92cdc58ec35e590acb0980f75ddfa32c",full:"380e390b6b8fd2d600c9035db7d13c29"},t=function(r){return e.post(""+n+"/jobs",i(r))},o=function(r){return e.get(""+n+"/jobs/"+r+"/progress.json?api_key="+a.full)},i=function(e){var r;return r=_.getFilename(e),{input:"s3://filepath",outputs:[{label:"low",format:"mp4",video_bitrate:200,decoder_bitrate_cap:300,decoder_buffer_size:1200,audio_sample_rate:44100,height:"288",url:"s3://encodes/"+u+"/"+r,h264_reference_frames:1,forced_keyframe_rate:"0.1",audio_bitrate:56,decimate:2,rrs:!0},{label:"high",format:"mp4",video_bitrate:1e3,decoder_bitrate_cap:1500,decoder_buffer_size:6e3,audio_sample_rate:44100,height:"432",url:"s3://encodes/"+u+"/"+r,h264_reference_frames:"auto",h264_profile:"main",forced_keyframe_rate:"0.1",audio_bitrate:56,rrs:!0},{source:"low",segment_video_snapshots:"true",url:"s3://encodes/"+u+"/"+r,copy_audio:"true",skip_video:"true",label:"hls-audio-only",type:"segmented",format:"aac",rrs:!0},{source:"low",format:"ts",copy_audio:"true",copy_video:"true",url:"s3://encodes/"+u+"/"+r,label:"hls-low",type:"segmented",rrs:!0},{source:"high",format:"ts",copy_audio:"true",copy_video:"true",url:"s3://encodes/"+u+"/"+r,label:"hls-high",type:"segmented",rrs:!0},{streams:[{path:"hls-low/"+r+"_hls-low.m3u8",bandwidth:256},{path:"hls-audio-only/"+r+"_hls-audio-only.m3u8",bandwidth:56},{path:"hls-high/"+r+"_hls-high.m3u8",bandwidth:1056}],type:"playlist",url:"s3://encodes/"+u+"/"+r}]}},l={createJob:t,getJobProgress:o}}]).config(["$httpProvider",function(e){return e.defaults.headers.common={},e.defaults.headers.post={},e.defaults.headers.post["Zencoder-Api-Key"]="380e390b6b8fd2d600c9035db7d13c29"}]);