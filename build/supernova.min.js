angular.module("fullscreen.tv",["ngCookies","ngGrid","templates","firebase"]).config(function(){var e;return e={getFilename:function(e,n){var r;return null==n&&(n=!0),r=_.last(e.split("/")),n?_.first(r.split(".")):r}},_.mixin(e)}).run(["$cookies","analytics",function(e,n){var r,t;return t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},r=function(){return""+t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},e.guid||(e.guid=r()),n.identify(e.guid)}]).run(["$rootScope","auth",function(e,n){return e.login=n.login}]),angular.module("fullscreen.tv").directive("upload",["$fileUploader","$location",function(e,n){return{restrict:"E",replace:!0,templateUrl:"upload.html",link:function(r){var t;return t=e.create({url:"/videos",alias:"video[file]",autoUpload:!0}),t.bind("completeall",function(){return t.clearQueue(),n.path("/uploads/manager")}),r.uploader=t}}}]),angular.module("fullscreen.tv").directive("uploadsManager",["$http","$timeout","$location","firebase","zencoder",function(e,n,r,t,i){return{restrict:"E",templateUrl:"../views/uploads_manager.html",link:function(e){var r,o,a;return e.uploads=t.getUploads(),e.uploads.$on("loaded",function(){return o()}),r=function(e,n){var r;return r=_.filter(e,function(e){return(null!=e?e.state:void 0)===n})},a=function(e){return _.each(e,function(e){return i.getJobProgress(e.id,e.job_id)})},o=function(t){var i,u,l,c;return null==t&&(t=5e3),i=a(r(e.uploads,"encoding")),u=a(r(e.uploads,"processing")),c=a(r(e.uploads,"waiting")),l=_.union(i,u,c),_.isEmpty(l)||n(function(){return l=o()},t),l},e.updateAllInWork=o},controller:["$scope",function(n){return n.kickOffJob=function(r){return e.post("videos/"+r+"/publish").then(function(){return n.updateAllInWork()})},n.removeUpload=function(n){return e["delete"]("videos/"+n)},n.watch=function(e,n){return"finished"===n?r.path("/watch/"+e):void 0}}]}}]),angular.module("fullscreen.tv").controller("uploadsController",["$scope","firebase","$filter","auth",function(e,n,r){return e.userUploads=[],e.gridOptions={data:"userUploads",columnDefs:[{field:"displayName",displayName:"Name"},{field:"filename",displayName:"Filename"},{field:"job",displayName:"Zencoder Job"},{field:"size",displayName:"Size"}]},n.userUploads.$on("loaded",function(t){return console.log("test",n.userUploads),r("orderByPriority")(t),e.userUploads=_(t).toArray(),e.$digest()})}]),angular.module("fullscreen.tv").directive("contenteditable",function(){return{restrict:"A",require:"ngModel",scope:{onBlur:"&"},link:function(e,n,r,t){return n.bind("keypress",function(){return function(e){return 13===e.keyCode?(e.preventDefault(),$(n).trigger("blur")):void 0}}(this)),n.bind("blur",function(){return e.$apply(function(){return t.$setViewValue(n.html()),n.addClass("edited"),e.onBlur()})}),t.$render=function(){return function(){return n.html(t.$viewValue)}}(this),t.$render()}}}),angular.module("fullscreen.tv").directive("filepicker",["$window","firebase","analytics","zencoder",function(e,n,r,t){return{restrict:"A",link:function(n){return n.filepicker=e.filepicker,n.filepicker.setKey("AiCDu1zCuQQysPoX9Mb9bz")},controller:["$scope",function(e){var i,o,a,u,l;return o={picker:{services:["COMPUTER","DROPBOX","BOX","GOOGLE_DRIVE"],container:"window",multiple:!0,mimetype:"video/*"},store:{path:"uploads/"+n.guid+"/"}},l=function(e){return a(e),u(e),r.track("Upload: Success",e)},i=function(e){return r.track("Upload: Error",e.toString())},a=function(e){return _(e).each(function(e){var r;return r=_.getFilename(e.key),e.displayName=r,n.userUploads[r]=e,n.userUploads.$save(r)})},u=function(e){var r;return r=_(e).pluck("key"),_(r).each(function(e){var r;return r=_.getFilename(e),console.log("filename",r),t.createJob(e).then(function(e){return n.userUploads.$child(r).$update({job:e.data.id}),n.userEncodes.$child(r).$update({jobId:e.data.id,files:e.data.outputs})})})},e.pick=function(){return e.filepicker.pickAndStore(o.picker,o.store,l,i)}}]}}]),angular.module("fullscreen.tv").directive("player",function(){return{restrict:"E",replace:!0,templateUrl:"player.html",scope:{video:"=",playlist:"="},link:function(e){return videojs("player").ready(function(){return e.player?void 0:(e.player=this,this.on("ended",function(){var n;return n=_.at(e.playlist,e.video.id),console.log("nextvideo",n)}))})},controller:["$scope",function(e){return e.$watch("playlist",function(n){var r;return console.log("playlist",n),e.video=getPlaybackVideo(n[null!=(r=e.video)?r.id:void 0])}),e.$watch("video",function(n){return n?void 0:e.video=getPlaybackVideo(null!=e?e.playlist[null!=n?n.id:void 0]:void 0)})}]}}),angular.module("fullscreen.tv").directive("speechToggle",["$rootScope",function(e){return{link:function(n,r){var t;return n.speaking=!1,n.speechEnabled=!0,n.disableSpeech=function(){return e.$broadcast("ba-speech-disable")},n.enableSpeech=function(){return e.$broadcast("ba-speech-enable")},e.$on("ba-speech-disable",function(){return n.speechEnabled=!1,n.$digest()}),e.$on("ba-speech-enable",function(){return n.speechEnabled=!0,n.$digest()}),e.$on("ba-speech-speaking",function(e){return console.log("asdfsadfsadf",e),n.speaking=e}),t=function(){return e.$broadcast(n.speechEnabled?"ba-speech-disable":"ba-speech-enable")},r.bind("click",function(){return function(){return t()}}(this))}}}]),angular.module("fullscreen.tv").directive("speech",["$window","$rootScope",function(e,n){return{restrict:"A",link:function(r,t,i){var o,a,u,l,c,s;if(null!=e?e.speechSynthesis:void 0)return r.enabled=!0,t.addClass("ba-speech"),u=e.speechSynthesis,l=e.SpeechSynthesisUtterance,s=new l,c=function(e){return e?t.addClass("speaking"):t.removeClass("speaking"),r.speaking=e,n.$broadcast("ba-speech-speaking",{speaking:r.speaking}),r.$digest()},s.onstart=function(){return c(!0)},s.onend=function(){return c(!1)},s.onpause=function(){return c(!1)},s.onresume=function(){return c(!0)},u.onvoiceschanged=function(){return function(){return s.voice=o(null!=i?i.language:void 0),i.debug&&console.log(s.voice),s.voiceURI=s.voice.voiceURI,s.lang=s.voice.lang,s.volume=1,s.rate=1.2,s.pitch=1}}(this),o=function(e){var n,r,t;return t=u.getVoices(),r=_(t).findWhere({"default":!0}),n=_(t).findWhere({lang:e}),n?n:r},a=function(e){return e&&r.enabled?(s.text=e,u.speak(s)):void 0},angular.element(t).bind("click",function(){return u.cancel(),a(i.speech)}),n.$on("ba-speech-disable",function(){return u.cancel(),r.enabled=!1}),n.$on("ba-speech-enable",function(){return r.enabled=!0})}}}]);var __slice=[].slice;angular.module("fullscreen.tv").factory("analytics",function(){var e;return e={},["page","pageview","track","identify"].forEach(function(n){return e[n]=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],window.analytics[n].apply(window.analytics,e)}}),e}).run(["analytics","$rootScope",function(e,n){return n.$on("$routeChangeSuccess",function(){return e.page()})}]),angular.module("fullscreen.tv").service("auth",["$firebase","$firebaseSimpleLogin","$cookies","config",function(e,n,r,t){var i,o,a,u,l,c,s;return i=n(new Firebase(t.firebase["default"])),s={complete:e(new Firebase(""+t.firebase.users+"/complete/"+r.guid)),basic:e(new Firebase(""+t.firebase.users+"/basic/"+r.guid))},a=function(e){switch(e){case"facebook":return console.log("config",t.firebase.auth.facebook),i.$login("facebook",t.firebase.auth.facebook).then(function(e){return c(e)});case"github":return i.$login("github",t.firebase.auth.github).then(function(e){return c(e)});case"twitter":return i.$login("twitter",t.firebase.auth.twitter).then(function(e){return c(e)})}},o=function(){return s?_.has(s.complete,"github")||_.has(s.complete,"facebook")||_.has(s.complete,"twitter"):!1},c=function(e){return l(e),u()},l=function(e){return s.complete[e.provider]=e,s.complete.$save()},u=function(){var e,n,t,i,o;return e=_.chain({}).defaults(null!=(i=s.complete)?i.twitter:void 0).defaults(null!=(t=s.complete)?t.facebook:void 0).defaults(null!=(n=s.complete)?n.github:void 0).value(),s.basic.guid=r.guid,s.basic.name=null!=e?e.displayName:void 0,s.basic.email=null!=e?e.email:void 0,s.basic.imageUrl=null!=e?e.avatar_url:void 0,s.basic.location=_.isString(null!=e?e.location:void 0)?null!=e?e.location:void 0:null!=(o=e.location)?o.name:void 0,s.basic.gender=null!=e?e.gender:void 0,s.basic.profileUrl=null!=e?e.profileUrl:void 0,s.basic.github=_.has(s.complete,"github"),s.basic.facebook=_.has(s.complete,"facebook"),s.basic.twitter=_.has(s.complete,"twitter"),s.basic.$save()},{login:a,hasAccount:o,user:s.basic,getCurrentUser:function(){return i.$getCurrentUser().then(function(e){return e})}}}]),angular.module("fullscreen.tv").constant("config",{env:"development",zencoder:{integration:"",read:"",full:""},firebase:{"default":"https://supernova.firebaseio.com/",uploads:"https://supernova.firebaseio.com/uploads",encodes:"https://supernova.firebaseio.com/encodes",users:"https://supernova.firebaseio.com/users",clock:"https://supernova.firebaseio.com/.info/serverTimeOffset",auth:{facebook:{scope:"user_birthday,friends_birthday",rememberMe:!0},github:{scope:"user:email",rememberMe:!0},twitter:{rememberMe:!0}}}}),angular.module("fullscreen.tv").service("firebase",["$firebase","$cookies","config","$rootScope","$q",function(e,n,r,t,i){var o,a,u,l,c,s,d,f;return o=new Firebase(r.firebase.clock),l=n.guid,s=e(new Firebase(r.firebase.uploads)),f=s.$child(l),a=e(new Firebase(r.firebase.encodes)),d=a.$child(l),u=function(){var e;return e=i.defer(),o.on("value",function(n){var r;return r=Date.now()+n.val(),e.resolve(r)}),e.promise},c={uploads:e(new Firebase(r.firebase.uploads)),userUploads:f,userEncodes:d,getServerTime:u,guid:l}}]),angular.module("fullscreen.tv").service("liveSync",["firebase","$window",function(e,n){var r,t,i;return navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,r=n.AudioContext||n.webkitAudioContext,i=function(e,n,t){var i,o,a;return o=(n-e)%t,console.log("jumpTo (in seconds)",o/1e3),console.log("jumpTo (in minutes)",o/1e3/60),i={video:!1,audio:!0},a=function(e){var n,t,i;return n=new r,i=n.createMediaStreamSource(e),t=n.createBiquadFilter(),i.connect(t),t.connect(n.destination)},navigator.getMedia(i,a)},e.getServerTime().then(function(e){var n,r;return r=13956876e5,n=132e4,i(r,e,n)}),t={sync:i}}]),angular.module("fullscreen.tv").service("zencoder",["$http","firebase",function(e,n){var r,t,i,o,a,u,l;return a=n.guid,r="https://app.zencoder.com/api/v2",u={read:"92cdc58ec35e590acb0980f75ddfa32c",full:"380e390b6b8fd2d600c9035db7d13c29"},t=function(n){return e.post(""+r+"/jobs",o(n))},i=function(n){return e.get(""+r+"/jobs/"+n+"/progress.json?api_key="+u.full)},o=function(e){var n;return n=_.getFilename(e),r="s3://fullscreen-tv",{input:""+r+"/"+e,outputs:[{label:"low",format:"mp4",video_bitrate:200,decoder_bitrate_cap:300,decoder_buffer_size:1200,audio_sample_rate:44100,height:"288",url:""+r+"/encodes/"+a+"/"+n+"-low.mp4",h264_reference_frames:1,forced_keyframe_rate:"0.1",audio_bitrate:56,decimate:2,rrs:!0},{label:"high",format:"mp4",video_bitrate:1e3,decoder_bitrate_cap:1500,decoder_buffer_size:6e3,audio_sample_rate:44100,height:"432",url:""+r+"/encodes/"+a+"/"+n+"-high.mp4",h264_reference_frames:"auto",h264_profile:"main",forced_keyframe_rate:"0.1",audio_bitrate:56,rrs:!0},{source:"low",segment_video_snapshots:"true",url:""+r+"/encodes/"+a+"/"+n+"-audio-only.m4a",copy_audio:"true",skip_video:"true",label:"hls-audio-only",type:"segmented",format:"aac",rrs:!0},{source:"low",format:"ts",copy_audio:"true",copy_video:"true",url:""+r+"/encodes/"+a+"/"+n+"-hls-low.mp4",label:"hls-low",type:"segmented",rrs:!0},{source:"high",format:"ts",copy_audio:"true",copy_video:"true",url:""+r+"/encodes/"+a+"/"+n+"-hls-high.mp4",label:"hls-high",type:"segmented",rrs:!0},{streams:[{path:"hls-low/"+n+"-hls-low.m3u8",bandwidth:256},{path:"hls-audio-only/"+n+"-hls-audio-only.m3u8",bandwidth:56},{path:"hls-high/"+n+"-hls-high.m3u8",bandwidth:1056}],type:"playlist",url:""+r+"/encodes/"+a+"/"+n+".m3u8"}]}},l={createJob:t,getJobProgress:i}}]).config(["$httpProvider",function(e){return e.defaults.headers.common={},e.defaults.headers.post={},e.defaults.headers.post["Zencoder-Api-Key"]="380e390b6b8fd2d600c9035db7d13c29"}]);