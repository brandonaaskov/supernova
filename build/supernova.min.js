angular.module("fullscreen.tv",["ngCookies","templates","firebase"]).run(["$cookies","analytics",function(e,r){var t,n;return n=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},t=function(){return""+n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},e.guid||(e.guid=t()),r.identify(e.guid)}]),angular.module("fullscreen.tv").directive("upload",["$fileUploader","$location",function(e,r){return{restrict:"E",replace:!0,templateUrl:"upload.html",link:function(t){var n;return n=e.create({url:"/videos",alias:"video[file]",autoUpload:!0}),n.bind("completeall",function(){return n.clearQueue(),r.path("/uploads/manager")}),t.uploader=n}}}]),angular.module("fullscreen.tv").directive("uploadsManager",["$http","$timeout","$location","firebase","zencoder",function(e,r,t,n,o){return{restrict:"E",templateUrl:"../views/uploads_manager.html",link:function(e){var t,a,i;return e.uploads=n.getUploads(),e.uploads.$on("loaded",function(){return a()}),t=function(e,r){var t;return t=_.filter(e,function(e){return(null!=e?e.state:void 0)===r})},i=function(e){return _.each(e,function(e){return o.getJobProgress(e.id,e.job_id)})},a=function(n){var o,u,l,s;return null==n&&(n=5e3),o=i(t(e.uploads,"encoding")),u=i(t(e.uploads,"processing")),s=i(t(e.uploads,"waiting")),l=_.union(o,u,s),_.isEmpty(l)||r(function(){return l=a()},n),l},e.updateAllInWork=a},controller:["$scope",function(r){return r.kickOffJob=function(t){return e.post("videos/"+t+"/publish").then(function(){return r.updateAllInWork()})},r.removeUpload=function(r){return e["delete"]("videos/"+r)},r.watch=function(e,r){return"finished"===r?t.path("/watch/"+e):void 0}}]}}]),angular.module("fullscreen.tv").controller("uploadsController",["$scope","firebase",function(e,r){return e.userUploads=r.userUploads}]),angular.module("fullscreen.tv").directive("filepicker",["$window","firebase","analytics","zencoder",function(e,r,t,n){return{restrict:"A",link:function(r){return r.filepicker=e.filepicker,r.filepicker.setKey("AiCDu1zCuQQysPoX9Mb9bz")},controller:["$scope",function(e){var o,a,i,u,l,s,c;return c=r.uploads.$child(r.guid),i={picker:{services:["COMPUTER","DROPBOX","BOX","GOOGLE_DRIVE"],container:"window",multiple:!0,mimetype:"video/*"},store:{path:"uploads/"+r.guid+"/"}},s=function(e){return u(e),l(e),t.track("Upload: Success",e)},o=function(e){return t.track("Upload: Error",e.toString())},a=function(e,t){var n;return null==t&&(t=!0),n=_.last(e.split("uploads/"+r.guid+"/")),t?_.first(n.split(".")):n},u=function(e){return _(e).each(function(e){var r;return r=a(e.key),c[r]=e,c.$save(r)})},l=function(e){var r;return r=_(e).pluck("key"),_(r).each(function(e){return n.createJob(e).then(function(r){return c.$child(a(e)).$update({zencoder:r})})})},e.pick=function(){return e.filepicker.pickAndStore(i.picker,i.store,s,o)}}]}}]),angular.module("fullscreen.tv").directive("player",function(){return{restrict:"E",replace:!0,templateUrl:"player.html",scope:{video:"=",playlist:"="},link:function(e){return videojs("player").ready(function(){return e.player?void 0:(e.player=this,this.on("ended",function(){var r;return r=_.at(e.playlist,e.video.id),console.log("nextvideo",r)}))})},controller:["$scope",function(e){return e.$watch("playlist",function(r){var t;return console.log("playlist",r),e.video=getPlaybackVideo(r[null!=(t=e.video)?t.id:void 0])}),e.$watch("video",function(r){return r?void 0:e.video=getPlaybackVideo(null!=e?e.playlist[null!=r?r.id:void 0]:void 0)})}]}}),angular.module("fullscreen.tv").directive("talkNerdyToMe",["$window",function(e){return{restrict:"A",link:function(r,t,n){var o,a,i,u;switch(null!=n&&null!=(u=n.accent)?u.toLowerCase():void 0){case"en-us":o="en-US";break;case"en-gb":o="en-GB";break;case"en-es":o="en-ES";break;case"fr-fr":o="fr-FR";break;case"it-it":o="it-IT";break;case"de-de":o="de-DE";break;case"ja-jp":o="en-JP";break;case"ko-kr":o="ko-KR";break;case"zh-cn":o="zh-CN";break;default:o="en-US"}return a={synthesis:e.speechSynthesis||e.speechSynthesisPolyfill,utterance:e.SpeechSynthesisUtterance||e.SpeechSynthesisUtterancePolyfill},i=new a.utterance,i.lang=o,i.volume=1,i.rate=1.2,r.speak=function(e){return i.text=e,a.synthesis.speak(i)},n.talkNerdyToMe?angular.element(t).bind("click",function(){return r.speak(n.talkNerdyToMe)}):void 0}}}]);var __slice=[].slice;angular.module("fullscreen.tv").factory("analytics",function(){var e;return e={},["page","pageview","track","identify"].forEach(function(r){return e[r]=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],window.analytics[r].apply(window.analytics,e)}}),e}).run(["analytics","$rootScope",function(e,r){return r.$on("$routeChangeSuccess",function(){return e.page()})}]),angular.module("fullscreen.tv").constant("config",{env:"development",zencoder:{integration:"",read:"",full:""},firebase:{"default":"https://supernova.firebaseio.com/",uploads:"https://supernova.firebaseio.com/uploads",clock:"https://supernova.firebaseio.com/.info/serverTimeOffset"}}),angular.module("fullscreen.tv").service("firebase",["$firebase","$cookies","config","$rootScope","$q",function(e,r,t,n,o){var a,i,u,l;return a=new Firebase(t.firebase.clock),u=r.guid,i=function(){var e;return e=o.defer(),a.on("value",function(r){var t;return t=Date.now()+r.val(),e.resolve(t)}),e.promise},l={uploads:e(new Firebase(t.firebase.uploads)),userUploads:e(new Firebase(""+t.firebase.uploads+"/"+u)),getServerTime:i,guid:u}}]),angular.module("fullscreen.tv").service("liveSync",["firebase","$window",function(e,r){var t,n,o;return navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,t=r.AudioContext||r.webkitAudioContext,o=function(e,r,n){var o,a,i;return a=(r-e)%n,console.log("jumpTo (in seconds)",a/1e3),console.log("jumpTo (in minutes)",a/1e3/60),o={video:!1,audio:!0},i=function(e){var r,n,o;return r=new t,o=r.createMediaStreamSource(e),n=r.createBiquadFilter(),o.connect(n),n.connect(r.destination)},navigator.getMedia(o,i)},e.getServerTime().then(function(e){var r,t;return t=13956876e5,r=132e4,o(t,e,r)}),n={sync:o}}]),angular.module("fullscreen.tv").service("zencoder",["$http","firebase",function(e,r){var t,n,o,a,i,u,l;return i=r.guid,t="https://app.zencoder.com/api/v2",u={read:"92cdc58ec35e590acb0980f75ddfa32c",full:"380e390b6b8fd2d600c9035db7d13c29"},n=function(r){return e.post(""+t+"/jobs",a(r))},o=function(r){return e.get(""+t+"/jobs/"+r+"/progress.json?api_key="+u.full)},a=function(e){return{input:"s3://uploads/"+i+"/"+e,outputs:[{label:"low",format:"mp4",video_bitrate:200,decoder_bitrate_cap:300,decoder_buffer_size:1200,audio_sample_rate:44100,height:"288",url:"s3://encodes/"+i+"/"+e,h264_reference_frames:1,forced_keyframe_rate:"0.1",audio_bitrate:56,decimate:2,rrs:!0},{label:"high",format:"mp4",video_bitrate:1e3,decoder_bitrate_cap:1500,decoder_buffer_size:6e3,audio_sample_rate:44100,height:"432",url:"s3://encodes/"+i+"/"+e,h264_reference_frames:"auto",h264_profile:"main",forced_keyframe_rate:"0.1",audio_bitrate:56,rrs:!0},{source:"low",segment_video_snapshots:"true",url:"s3://encodes/"+i+"/"+e,copy_audio:"true",skip_video:"true",label:"hls-audio-only",type:"segmented",format:"aac",rrs:!0},{source:"low",format:"ts",copy_audio:"true",copy_video:"true",url:"s3://encodes/"+i+"/"+e,label:"hls-low",type:"segmented",rrs:!0},{source:"high",format:"ts",copy_audio:"true",copy_video:"true",url:"s3://encodes/"+i+"/"+e,label:"hls-high",type:"segmented",rrs:!0},{streams:[{path:"hls-low/"+e+"_hls-low.m3u8",bandwidth:256},{path:"hls-audio-only/"+e+"_hls-audio-only.m3u8",bandwidth:56},{path:"hls-high/"+e+"_hls-high.m3u8",bandwidth:1056}],type:"playlist",url:"s3://encodes/"+i+"/"+e}]}},l={createJob:n,getJobProgress:o}}]).config(["$httpProvider",function(e){return e.defaults.headers.common={},e.defaults.headers.post={},e.defaults.headers.post["Zencoder-Api-Key"]="380e390b6b8fd2d600c9035db7d13c29"}]);