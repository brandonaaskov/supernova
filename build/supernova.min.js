angular.module("fullscreen.tv",["ngCookies","ngGrid","templates","firebase"]).config(function(){var e;return e={getFilename:function(e,n){var r;return null==n&&(n=!0),r=_.last(e.split("/")),n?_.first(r.split(".")):r}},_.mixin(e)}).run(["$cookies","analytics",function(e,n){var r,t;return t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},r=function(){return""+t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},e.guid||(e.guid=r()),n.identify(e.guid)}]),angular.module("fullscreen.tv").directive("upload",["$fileUploader","$location",function(e,n){return{restrict:"E",replace:!0,templateUrl:"upload.html",link:function(r){var t;return t=e.create({url:"/videos",alias:"video[file]",autoUpload:!0}),t.bind("completeall",function(){return t.clearQueue(),n.path("/uploads/manager")}),r.uploader=t}}}]),angular.module("fullscreen.tv").directive("uploadsManager",["$http","$timeout","$location","firebase","zencoder",function(e,n,r,t,o){return{restrict:"E",templateUrl:"../views/uploads_manager.html",link:function(e){var r,i,a;return e.uploads=t.getUploads(),e.uploads.$on("loaded",function(){return i()}),r=function(e,n){var r;return r=_.filter(e,function(e){return(null!=e?e.state:void 0)===n})},a=function(e){return _.each(e,function(e){return o.getJobProgress(e.id,e.job_id)})},i=function(t){var o,u,l,s;return null==t&&(t=5e3),o=a(r(e.uploads,"encoding")),u=a(r(e.uploads,"processing")),s=a(r(e.uploads,"waiting")),l=_.union(o,u,s),_.isEmpty(l)||n(function(){return l=i()},t),l},e.updateAllInWork=i},controller:["$scope",function(n){return n.kickOffJob=function(r){return e.post("videos/"+r+"/publish").then(function(){return n.updateAllInWork()})},n.removeUpload=function(n){return e["delete"]("videos/"+n)},n.watch=function(e,n){return"finished"===n?r.path("/watch/"+e):void 0}}]}}]),angular.module("fullscreen.tv").controller("uploadsController",["$scope","firebase","$filter",function(e,n,r){return e.userUploads=[],e.gridOptions={data:"userUploads",columnDefs:[{field:"displayName",displayName:"Name"},{field:"filename",displayName:"Filename"},{field:"job",displayName:"Zencoder Job"},{field:"size",displayName:"Size"}]},n.userUploads.$on("loaded",function(n){return r("orderByPriority")(n),e.userUploads=_(n).toArray(),console.log("$scope.userUploads",e.userUploads),e.$digest()}),console.log("userUploads (firebase)",n.userUploads),console.log("userUploads",e.userUploads)}]),angular.module("fullscreen.tv").directive("contenteditable",function(){return{restrict:"A",require:"ngModel",scope:{onBlur:"&"},link:function(e,n,r,t){return n.bind("keypress",function(){return function(e){return 13===e.keyCode?(e.preventDefault(),$(n).trigger("blur")):void 0}}(this)),n.bind("blur",function(){return e.$apply(function(){return t.$setViewValue(n.html()),n.addClass("edited"),e.onBlur()})}),t.$render=function(){return function(){return n.html(t.$viewValue)}}(this),t.$render()}}}),angular.module("fullscreen.tv").directive("filepicker",["$window","firebase","analytics","zencoder",function(e,n,r,t){return{restrict:"A",link:function(n){return n.filepicker=e.filepicker,n.filepicker.setKey("AiCDu1zCuQQysPoX9Mb9bz")},controller:["$scope",function(e){var o,i,a,u,l;return i={picker:{services:["COMPUTER","DROPBOX","BOX","GOOGLE_DRIVE"],container:"window",multiple:!0,mimetype:"video/*"},store:{path:"uploads/"+n.guid+"/"}},l=function(e){return a(e),u(e),r.track("Upload: Success",e)},o=function(e){return r.track("Upload: Error",e.toString())},a=function(e){return _(e).each(function(e){var r;return r=_.getFilename(e.key),e.displayName=r,n.userUploads[r]=e,n.userUploads.$save(r)})},u=function(e){var r;return r=_(e).pluck("key"),_(r).each(function(e){var r;return r=_.getFilename(e),console.log("filename",r),t.createJob(e).then(function(e){return n.userUploads.$child(r).$update({job:e.data.id}),n.userEncodes.$child(r).$update({jobId:e.data.id,files:e.data.outputs})})})},e.pick=function(){return e.filepicker.pickAndStore(i.picker,i.store,l,o)}}]}}]),angular.module("fullscreen.tv").directive("player",function(){return{restrict:"E",replace:!0,templateUrl:"player.html",scope:{video:"=",playlist:"="},link:function(e){return videojs("player").ready(function(){return e.player?void 0:(e.player=this,this.on("ended",function(){var n;return n=_.at(e.playlist,e.video.id),console.log("nextvideo",n)}))})},controller:["$scope",function(e){return e.$watch("playlist",function(n){var r;return console.log("playlist",n),e.video=getPlaybackVideo(n[null!=(r=e.video)?r.id:void 0])}),e.$watch("video",function(n){return n?void 0:e.video=getPlaybackVideo(null!=e?e.playlist[null!=n?n.id:void 0]:void 0)})}]}}),angular.module("fullscreen.tv").directive("speechToggle",["$rootScope",function(e){return{link:function(n,r){var t;return n.speechEnabled=!0,n.disableSpeech=function(){return e.$broadcast("ba-speech-disable")},n.enableSpeech=function(){return e.$broadcast("ba-speech-enable")},e.$on("ba-speech-disable",function(){return n.speechEnabled=!1,n.$digest()}),e.$on("ba-speech-enable",function(){return n.speechEnabled=!0,n.$digest()}),t=function(){return e.$broadcast(n.speechEnabled?"ba-speech-disable":"ba-speech-enable")},r.bind("click",function(){return function(){return t()}}(this))}}}]),angular.module("fullscreen.tv").directive("speech",["$window","$rootScope",function(e,n){return{restrict:"A",link:function(r,t,o){var i,a,u,l,s,c;if(null!=e?e.speechSynthesis:void 0)return r.enabled=!0,t.addClass("ba-speech"),u=e.speechSynthesis,l=e.SpeechSynthesisUtterance,c=new l,s=function(e){return e?t.addClass("speaking"):t.removeClass("speaking"),r.speaking=e,r.$digest()},c.onstart=function(){return s(!0)},c.onend=function(){return s(!1)},c.onpause=function(){return s(!1)},c.onresume=function(){return s(!0)},u.onvoiceschanged=function(){return function(){return c.voice=i(null!=o?o.language:void 0),o.debug&&console.log(c.voice),c.voiceURI=c.voice.voiceURI,c.lang=c.voice.lang,c.volume=1,c.rate=1.2,c.pitch=1}}(this),i=function(e){var n,r,t;return t=u.getVoices(),r=_(t).findWhere({"default":!0}),n=_(t).findWhere({lang:e}),n?n:r},a=function(e){return e&&r.enabled?(c.text=e,u.speak(c)):void 0},angular.element(t).bind("click",function(){return u.cancel(),a(o.speech)}),n.$on("ba-speech-disable",function(){return u.cancel(),r.enabled=!1}),n.$on("ba-speech-enable",function(){return r.enabled=!0})}}}]);var __slice=[].slice;angular.module("fullscreen.tv").factory("analytics",function(){var e;return e={},["page","pageview","track","identify"].forEach(function(n){return e[n]=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],window.analytics[n].apply(window.analytics,e)}}),e}).run(["analytics","$rootScope",function(e,n){return n.$on("$routeChangeSuccess",function(){return e.page()})}]),angular.module("fullscreen.tv").constant("config",{env:"development",zencoder:{integration:"",read:"",full:""},firebase:{"default":"https://supernova.firebaseio.com/",uploads:"https://supernova.firebaseio.com/uploads",encodes:"https://supernova.firebaseio.com/encodes",clock:"https://supernova.firebaseio.com/.info/serverTimeOffset"}}),angular.module("fullscreen.tv").service("firebase",["$firebase","$cookies","config","$rootScope","$q",function(e,n,r,t,o){var i,a,u,l,s,c,d,f;return i=new Firebase(r.firebase.clock),l=n.guid,c=e(new Firebase(r.firebase.uploads)),f=c.$child(l),a=e(new Firebase(r.firebase.encodes)),d=a.$child(l),u=function(){var e;return e=o.defer(),i.on("value",function(n){var r;return r=Date.now()+n.val(),e.resolve(r)}),e.promise},s={uploads:e(new Firebase(r.firebase.uploads)),userUploads:f,userEncodes:d,getServerTime:u,guid:l}}]),angular.module("fullscreen.tv").service("liveSync",["firebase","$window",function(e,n){var r,t,o;return navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,r=n.AudioContext||n.webkitAudioContext,o=function(e,n,t){var o,i,a;return i=(n-e)%t,console.log("jumpTo (in seconds)",i/1e3),console.log("jumpTo (in minutes)",i/1e3/60),o={video:!1,audio:!0},a=function(e){var n,t,o;return n=new r,o=n.createMediaStreamSource(e),t=n.createBiquadFilter(),o.connect(t),t.connect(n.destination)},navigator.getMedia(o,a)},e.getServerTime().then(function(e){var n,r;return r=13956876e5,n=132e4,o(r,e,n)}),t={sync:o}}]),angular.module("fullscreen.tv").service("zencoder",["$http","firebase",function(e,n){var r,t,o,i,a,u,l;return a=n.guid,r="https://app.zencoder.com/api/v2",u={read:"92cdc58ec35e590acb0980f75ddfa32c",full:"380e390b6b8fd2d600c9035db7d13c29"},t=function(n){return e.post(""+r+"/jobs",i(n))},o=function(n){return e.get(""+r+"/jobs/"+n+"/progress.json?api_key="+u.full)},i=function(e){var n;return n=_.getFilename(e),r="s3://fullscreen-tv",{input:""+r+"/"+e,outputs:[{label:"low",format:"mp4",video_bitrate:200,decoder_bitrate_cap:300,decoder_buffer_size:1200,audio_sample_rate:44100,height:"288",url:""+r+"/encodes/"+a+"/"+n+"-low.mp4",h264_reference_frames:1,forced_keyframe_rate:"0.1",audio_bitrate:56,decimate:2,rrs:!0},{label:"high",format:"mp4",video_bitrate:1e3,decoder_bitrate_cap:1500,decoder_buffer_size:6e3,audio_sample_rate:44100,height:"432",url:""+r+"/encodes/"+a+"/"+n+"-high.mp4",h264_reference_frames:"auto",h264_profile:"main",forced_keyframe_rate:"0.1",audio_bitrate:56,rrs:!0},{source:"low",segment_video_snapshots:"true",url:""+r+"/encodes/"+a+"/"+n+"-audio-only.m4a",copy_audio:"true",skip_video:"true",label:"hls-audio-only",type:"segmented",format:"aac",rrs:!0},{source:"low",format:"ts",copy_audio:"true",copy_video:"true",url:""+r+"/encodes/"+a+"/"+n+"-hls-low.mp4",label:"hls-low",type:"segmented",rrs:!0},{source:"high",format:"ts",copy_audio:"true",copy_video:"true",url:""+r+"/encodes/"+a+"/"+n+"-hls-high.mp4",label:"hls-high",type:"segmented",rrs:!0},{streams:[{path:"hls-low/"+n+"-hls-low.m3u8",bandwidth:256},{path:"hls-audio-only/"+n+"-hls-audio-only.m3u8",bandwidth:56},{path:"hls-high/"+n+"-hls-high.m3u8",bandwidth:1056}],type:"playlist",url:""+r+"/encodes/"+a+"/"+n+".m3u8"}]}},l={createJob:t,getJobProgress:o}}]).config(["$httpProvider",function(e){return e.defaults.headers.common={},e.defaults.headers.post={},e.defaults.headers.post["Zencoder-Api-Key"]="380e390b6b8fd2d600c9035db7d13c29"}]);